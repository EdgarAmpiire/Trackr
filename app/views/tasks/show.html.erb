<!-- Back Button -->
<div class="max-w-3xl mx-auto mt-4">
  <%= link_to tasks_path, class: "inline-flex items-center gap-2 text-gray-600 hover:text-green-600 font-medium transition-all duration-200" do %>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
         viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
    Back to Tasks
  <% end %>
</div>

<!-- Task Card -->
<%= turbo_frame_tag dom_id(@task) do %>
<div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-md p-6 mt-6 border border-gray-100">
  <!-- Task Header -->
  <div class="flex justify-between items-center mb-4">
    <div>
      <h2 class="text-3xl font-bold text-gray-800 mb-1">
        <%= @task.title %>
      </h2>
      <p class="text-gray-500 text-sm italic">
        Added by 
        <%= [@task.user&.first_name, @task.user&.last_name].compact.join(' ').presence || "Unknown user" %>
      </p>
    </div>

    <!-- Completion Button -->
    <%= button_to toggle_complete_task_path(@task),
        method: :patch,
        form: { data: { turbo_stream: true } },
        class: "cursor-pointer flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm
                #{@task.completed ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" do %>
      <%= raw('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M9 1.5H5.625c-1.036 0-1.875.84-1.875 
                1.875v17.25c0 1.035.84 1.875 1.875 
                1.875h12.75c1.035 0 1.875-.84 
                1.875-1.875V12.75A3.75 3.75 0 0 
                0 16.5 9h-1.875a1.875 1.875 0 0 
                1-1.875-1.875V5.25A3.75 3.75 0 0 
                0 9 1.5Zm6.61 10.936a.75.75 0 1 
                0-1.22-.872l-3.236 4.53L9.53 
                14.47a.75.75 0 0 0-1.06 
                1.06l2.25 2.25a.75.75 0 0 
                0 1.14-.094l3.75-5.25Z" 
                clip-rule="evenodd"/>
                <path d="M12.971 1.816A5.23 5.23 0 0 1 
                14.25 5.25v1.875c0 
                .207.168.375.375.375H16.5a5.23 
                5.23 0 0 1 3.434 
                1.279 9.768 9.768 0 0 
                0-6.963-6.963Z"/>
              </svg>') %>
      <%= @task.completed ? "Mark Incomplete" : "Mark Complete" %>
    <% end %>
  </div>
  <% end %>

  <!-- Task Description -->
  <p class="text-gray-700 leading-relaxed mb-4 border-l-4 border-green-500 pl-4">
    <%= @task.description.presence || "No description provided." %>
  </p>
</div>

<!-- Comments Section -->
<div class="max-w-3xl mx-auto mt-8">
  <h3 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2">Comments</h3>

  <%= turbo_frame_tag "comments" do %>
    <div id="comments" class="space-y-3">
      <% if @task.comments.any? %>
        <%= render @task.comments %>
      <% else %>
        <p class="text-gray-500 italic">No comments yet. Be the first to comment!</p>
      <% end %>
    </div>
  <% end %>

  <!-- New comment form -->
  <div class="mt-6">
    <%= turbo_frame_tag "new_comment" do %>
      <%= render "comments/form", task: @task, comment: @comment %>
    <% end %>
  </div>
</div>
